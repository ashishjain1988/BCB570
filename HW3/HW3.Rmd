---
title: "BCB570 Assignment 3"
author: "Ashish Jain"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
    echo = TRUE,
    message = FALSE,
    warning = FALSE
)
```

#Question 1:

##i).

##Network Details
```{r, tidy=TRUE, tidy.opts=list(width.cutoff=60)}
library("tidyverse")
library("igraph")
library("pander")

graphDetails<-function(edgeFile,sep)
{
  graph<-as.matrix(read.table((edgeFile),sep = sep))
  graphGraph1<-graph.data.frame(graph,directed = FALSE)
  graphGraph<-simplify(graphGraph1,remove.multiple = TRUE, remove.loops = TRUE,
  edge.attr.comb = igraph_opt("edge.attr.comb"))
  graphDetails<-c(vcount(graphGraph), ecount(graphGraph), graph.density(graphGraph),diameter(graphGraph), radius(graphGraph), transitivity(graphGraph, type = "average"),transitivity(graphGraph, type = "global"),mean_distance(graphGraph))
  return(list(graphDetails,graphGraph))
}
path<-"https://raw.githubusercontent.com/ashishjain1988/BCB570/master/HW3/"
outputY2H_uniondata<-graphDetails(paste0(path,"Y2H_uniondata.txt"),"\t")
outputCCSB_YI1data<-graphDetails(paste0(path,"CCSB_YI1.txt"),"\t")
essentialGenes<-read.table(paste0(path,"essentialGenes.txt"))

details<-c("Number of Nodes","Number of Edges","Graph Density","Diameter","Radius","Average Clustering Coefficent","Global Clustering Coefficent","Average Shortest Path")

table<-data.frame(Headings=details,"Y2H-Union"=outputY2H_uniondata[[1]],"CCSB-YI1"=outputCCSB_YI1data[[1]])
table %>% knitr::kable(caption = "PPI Details of the Network")

graphUnion<-outputY2H_uniondata[[2]]
graphCCSB<-outputCCSB_YI1data[[2]]

gdetails<-function(graphGraph1)
{
  graphGraph<-simplify(graphGraph1,remove.multiple = TRUE, remove.loops = TRUE,
  edge.attr.comb = igraph_opt("edge.attr.comb"))
  graphDetails<-c(vcount(graphGraph), ecount(graphGraph), graph.density(graphGraph),diameter(graphGraph), radius(graphGraph), transitivity(graphGraph, type = "average"),transitivity(graphGraph, type = "global"),mean_distance(graphGraph))
  return(graphDetails)
}

largestSubNet<-function(graph)
{
  dGraph<-decompose.graph(graph)
  lgraph<-dGraph[[1]]
  for(i in 1:length(dGraph))
  {
    if(vcount(lgraph) < vcount(dGraph[[i]]))
    {
      lgraph <- dGraph[[i]]
    }
  }
  return(lgraph)
}

lgraphUnion<-largestSubNet(graphUnion)
lgraphCCSB<-largestSubNet(graphCCSB)

table<-data.frame(Headings=details,"Y2H-Union"=gdetails(lgraphUnion),"CCSB-YI1"=gdetails(lgraphCCSB))
table %>% knitr::kable(caption = "PPI Details of largest sub-network")

```


##Small World Network Test
```{r, tidy=TRUE, tidy.opts=list(width.cutoff=60)}

##Small world property

getRandomNetworkDetails<-function(graph)
{
  randomNetwork <- erdos.renyi.game(vcount(graph), ecount(graph),type='gnm')
  output1<-average.path.length(graph)
  output2<-average.path.length(randomNetwork)
  output3<-transitivity(graph, type="global")
  output4<-transitivity(randomNetwork, type="global")
  return(c(output1,output2,output3,output4))
}

#randomGraphAverageLength<-rep(average.path.length(erdos.renyi.game(vcount(graphUnion), ecount(graphUnion),type='gnm')),100)

#randomGraphAverageLength<-rep(transitivity(erdos.renyi.game(vcount(graphUnion), ecount(graphUnion ),type='gnm'),type="global"),100)

graphUnionProp<-getRandomNetworkDetails(graphUnion)
graphCCSBProp<-getRandomNetworkDetails(graphCCSB)

details<-c("Average Path Length-Graph","Average Path Length-Random Graph","Clustering Coefficient-Graph","Clustering Coefficient-Random Graph")

table<-data.frame(Features=details,"Y2H-Union"=graphUnionProp,"CCSB-YI1"=graphCCSBProp)
table %>% knitr::kable(caption = "Small-World Property Test of the Network")
```

From the table 3, it can be seen that none of the networks satisfies the small-world network properties. Although, both the networks have very large clustering coefficient compared to the random network with same number of nodes but the average path length is less than that of the random network.

```{r, tidy=TRUE, tidy.opts=list(width.cutoff=60)}
table<-data.frame(Features=details,"Y2H-Union"=getRandomNetworkDetails(lgraphUnion),"CCSB-YI1"=getRandomNetworkDetails(lgraphCCSB))
table %>% knitr::kable(caption = "Small-World Property Test for largest sub-network")
```

From the table 4, it can be seen that none of the largest sub-network satisfies the small-world network properties. Although, both the networks have very large clustering coefficient compared to the random network with same number of nodes but the average path length is less than that of the random network.

##Scale Free Network Test
```{r, tidy=TRUE, tidy.opts=list(width.cutoff=60)}

##Power law fit
fitUnion <- power.law.fit(degree(graphUnion),9,implementation="plfit") 
fitCCSB <- power.law.fit(degree(graphCCSB),9,implementation="plfit") 

details<-c("Graph Union","Graph CCSB")

table<-data.frame(Graph=details,Alpha=c(fitUnion$alpha,fitCCSB$alpha),"X-min"=c(fitUnion$xmin,fitCCSB$xmin),"P-Value"=c(fitUnion$KS.p,fitCCSB$KS.p))
table %>% knitr::kable(caption = "Power Law Fit Details of the Network")

```

From table 5, it can be seen that Y2H-Union and CCSB-YI network has P-Value greater than 0.05 which means that we are not able to reject the null hypothesis that the original data could have been drawn from the fitted power-law distribution. The hubs in the graphs are also significant as the $\alpha$ is between 2 and 3 in both the cases.

```{r, tidy=TRUE, tidy.opts=list(width.cutoff=60)}
##Power law fit
fitUnion <- power.law.fit(degree(lgraphUnion),9,implementation="plfit") 
fitCCSB <- power.law.fit(degree(lgraphCCSB),9,implementation="plfit") 

table<-data.frame(Graph=details,Alpha=c(fitUnion$alpha,fitCCSB$alpha),"X-min"=c(fitUnion$xmin,fitCCSB$xmin),"P-Value"=c(fitUnion$KS.p,fitCCSB$KS.p))
table %>% knitr::kable(caption = "Power Law Fit Details of largest sub-network")
```

Also from table 6, it can be seen that the largest subnetwork of Y2H-Union and CCSB-YI networks has P-Value greater than 0.05 which means that we are not able to reject the null hypothesis that the original data could have been drawn from the fitted power-law distribution. The hubs in the graphs are also significant as the $\alpha$ is between 2 and 3 in both the cases.

##ii). Finding the hubs based on degree centrality
```{r, tidy=TRUE, tidy.opts=list(width.cutoff=50)}
data<-data.frame(prob=degree.distribution(graphUnion), degree=c(1:length(degree.distribution(graphUnion))))
data %>% ggplot(aes(x=degree,y=prob)) + geom_point() + geom_line() + labs(x="Degree",y="Probability (Degree)", title="Degree Distribution of Y2H Union PPI") +theme(plot.title = element_text(hjust = 0.5))

data<-data.frame(prob=degree.distribution(graphCCSB), degree=c(1:length(degree.distribution(graphCCSB))))
data %>% ggplot(aes(x=degree,y=prob)) + geom_point() + geom_line() + labs(x="Degree",y="Probability (Degree)", title="Degree Distribution of CCSB PPI") +theme(plot.title = element_text(hjust = 0.5))

data<-data.frame(prob=degree.distribution(lgraphUnion), degree=c(1:length(degree.distribution(lgraphUnion))))
data %>% ggplot(aes(x=degree,y=prob)) + geom_point() + geom_line() + labs(x="Degree",y="Probability (Degree)", title="Degree Distribution of Y2H Union PPI largest sub-network") +theme(plot.title = element_text(hjust = 0.5))

data<-data.frame(prob=degree.distribution(lgraphCCSB), degree=c(1:length(degree.distribution(lgraphCCSB))))
data %>% ggplot(aes(x=degree,y=prob)) + geom_point() + geom_line() + labs(x="Degree",y="Probability (Degree)", title="Degree Distribution of CCSB PPI of largest sub-network") +theme(plot.title = element_text(hjust = 0.5))
```

From the degree distribution of the plot we define hubs which have degree greater than or equal to 8.

##Intersection of the essential genes and hubs in whole network
```{r, tidy=TRUE, tidy.opts=list(width.cutoff=60)}
hubNodesUnion<-names(which(igraph::degree(graphUnion) >= 8, arr.ind = T))
hubNodesCCSB<-names(which(igraph::degree(graphCCSB) >= 8, arr.ind = T))
length(hubNodesUnion)
length(hubNodesCCSB)
#rhubNodesUnion<-sample(V(graphUnion),length(hubNodesUnion))
#rhubNodesCCSB<-sample(V(graphCCSB),length(hubNodesCCSB))

#intersect(rhubNodesUnion,as.vector(essentialGenes[,1]))
#intersect(rhubNodesCCSB,as.vector(essentialGenes[,1]))
details<-c("Graph Union","Graph CCSB")
table<-data.frame(Graph=details,Overlap=c(toString(intersect(hubNodesUnion,as.vector(essentialGenes[,1]))),toString(intersect(hubNodesCCSB,as.vector(essentialGenes[,1])))))
table %>% knitr::kable(caption = "Essential genes overlap with hub genes of Network")
```

##Intersection of the essential genes and hubs in largest sub-network
```{r, tidy=TRUE, tidy.opts=list(width.cutoff=60)}
hubNodeslUnion<-names(which(igraph::degree(lgraphUnion) >= 8, arr.ind = T))
hubNodeslCCSB<-names(which(igraph::degree(lgraphCCSB) >= 8, arr.ind = T))
length(hubNodeslUnion)
length(hubNodeslCCSB)
#rhubNodeslUnion<-rep(intersect(sample(V(lgraphUnion),length(hubNodeslUnion)),as.vector(essentialGenes[,1])),100)
#rhubNodeslCCSB<-sample(V(lgraphCCSB),length(hubNodeslCCSB))

#intersect(rhubNodeslUnion,as.vector(essentialGenes[,1]))
#intersect(rhubNodeslCCSB,as.vector(essentialGenes[,1]))
details<-c("Graph Union","Graph CCSB")
table<-data.frame(Graph=details,Overlap=c(toString(intersect(hubNodeslUnion,as.vector(essentialGenes[,1]))),toString(intersect(hubNodeslCCSB,as.vector(essentialGenes[,1])))))
table %>% knitr::kable(caption = "Essential genes overlap with hub genes of largest sub-network")

```

As seen from the above results, only four essential genes overlapped with the hub genes based on the degree distrubution. These genes includes YDR388W (8), YGL115W (8), YLR423C (80), and YPL031C (12). Out of these YLR423C, and YPL031C genes found in both the PPI networks as well as in the essential genes. The biological functions of these genes are shown in table below.

```{r, tidy=TRUE, tidy.opts=list(width.cutoff=60)}
details<-c("YDR388W", "YGL115W", "YLR423C","YPL031C")
table<-data.frame(Gene=details,"Function"=c("Calmodulin-binding actin-associated protein; roles in endocytic membrane tabulation and constriction, and exocytosis; viability following starvation or osmotic stress","activates glucose-repressed genes, represses glucose-induced genes; role in sporulation, and peroxisome biogenesis;","phagophore assembly site organization; regulatory subunit of an autophagy-specific complex that includes Atg1p and Atg13p; stimulates Atg1p kinase activity;","has ten cyclin partners; involved in regulating the cellular response to nutrient levels and environmental conditions and progression through the cell cycle."))
table %>% pandoc.table(style = "rmarkdown",caption = "Essential genes overlap with hub genes of largest connected sub-network")
#table %>% knitr::kable()
```


##iii).


#Question 2:

##i).

##Central genes based on the betweenness centrality
```{r, tidy=TRUE, tidy.opts=list(width.cutoff=60)}

top5percentUnion<-vcount(lgraphUnion)*0.05
centralGenesUnion<-names(sort(igraph::betweenness(lgraphUnion),decreasing = TRUE)[1:as.integer(top5percentUnion)])
#length(centralGenesUnion)
centralGenesUnion

top5percentCCSB<-vcount(lgraphCCSB)*0.05
centralGenesCCSB<-names(sort(igraph::betweenness(lgraphCCSB),decreasing = TRUE)[1:as.integer(top5percentCCSB)])
#length(centralGenesCCSB)
centralGenesCCSB

details<-c("Graph Union","Graph CCSB")
table<-data.frame(Graph=details,Overlap=c(toString(intersect(centralGenesUnion,as.vector(essentialGenes[,1]))),toString(intersect(centralGenesCCSB,as.vector(essentialGenes[,1])))))
table %>% knitr::kable(caption = "Essential genes overlap with hub genes of largest sub-network")

```

As seen from the above results, only three essential genes overlapped with the hub genes based on the betweeness. These genes includes YKL002W (7), YLR423C (80), and YPL031C (12). Both the genes YLR423C, and YPL031C pops up as the hub genes based on two centralities we have used.


##ii).
```{r, tidy=TRUE, tidy.opts=list(width.cutoff=60)}
gUniond10 <- delete.edges(lgraphUnion, E(lgraphUnion)[sample(seq_along(E(lgraphUnion)), 0.1*ecount(lgraphUnion))])
gUniond25 <- delete.edges(lgraphUnion, E(lgraphUnion)[sample(seq_along(E(lgraphUnion)), 0.25*ecount(lgraphUnion))])
gCCSBd10 <- delete.edges(lgraphCCSB, E(lgraphCCSB)[sample(seq_along(E(lgraphCCSB)), 0.1*ecount(lgraphCCSB))])
gCCSBd25 <- delete.edges(lgraphCCSB, E(lgraphCCSB)[sample(seq_along(E(lgraphCCSB)), 0.25*ecount(lgraphCCSB))])
#write_graph(gUniond10,"UnionD10.txt","ncol")
#write_graph(gUniond25,"UnionD25.txt","ncol")
#write_graph(gCCSBd10,"CCSBD10.txt","ncol")
#write_graph(gCCSBd25,"CCSBD25.txt","ncol")

details<-c("Graph Union D10%","Graph Union D25%","Graph CCSB D10%","Graph CCSB D25%")
table<-data.frame(Graph=details,"Whole-Net-Degree"=c(1573,1413,925,832),"Whole-Net-Edges"=c(2267, 1889, 1339,1116),"Sub-Net-Degree"=c(1520,1303,881,779),"Sub-Net-Edges"=c(2230, 1822, 1303,1086))
table %>% knitr::kable(caption = "Details of the Deleted Networks")
```

We have deleted 10% and 25% edges from the largest connected sub-network of both the PPI networks. After that, we extracted the largest connected sub-network from that PPI network and performed the MCL clustering in cytoscape. We have used the [**Cluster Maker2**](http://apps.cytoscape.org/apps/clustermaker2) plugin for carrying out the MCL clustering in cytoscape.

```{r, tidy=TRUE, tidy.opts=list(width.cutoff=60)}
#path<-"/Users/jain/BCB570/HW3/"
#graphUnionClust<-read_graph(paste0(path,"Union_lsub-cluster.graphml"),format="graphml")
outputgraphUnionClust<-graphDetails(paste0(path,"Union-lsub-clustered.csv"),",")
outputgraphUnionD10Clust<-graphDetails(paste0(path,"Union-D10-Clust.csv"),",")
outputgraphUnionD25Clust<-graphDetails(paste0(path,"Union-D25-Clust.csv"),",")
outputgraphCCSBClust<-graphDetails(paste0(path,"CCSB-lsub-clustered.csv"),",")
outputgraphCCSBD10Clust<-graphDetails(paste0(path,"CCSB-D10-clust.csv"),",")
outputgraphCCSBD25Clust<-graphDetails(paste0(path,"CCSB-D25-Clust.csv"),",")

lgraphUnionClust<-largestSubNet(outputgraphUnionClust[[2]])
lgraphUnionD10Clust<-largestSubNet(outputgraphUnionD10Clust[[2]])
lgraphUnionD25Clust<-largestSubNet(outputgraphUnionD25Clust[[2]])
lgraphCCSBClust<-largestSubNet(outputgraphCCSBClust[[2]])
lgraphCCSBD10Clust<-largestSubNet(outputgraphCCSBD10Clust[[2]])
lgraphCCSBD25Clust<-largestSubNet(outputgraphCCSBD25Clust[[2]])

details<-c("Number of Nodes","Number of Edges","Graph Density","Diameter","Radius","Average Clustering Coefficent","Global Clustering Coefficent","Average Shortest Path")
table<-data.frame(Headings=details,"Y2H-Union"=gdetails(lgraphUnionClust),"Y2H-UnionD10"=gdetails(lgraphUnionD10Clust),"Y2H-UnionD25"=gdetails(lgraphUnionD25Clust),"CCSB-YI1"=gdetails(lgraphCCSBClust),"CCSB-YI1D10"=gdetails(lgraphCCSBD10Clust),"CCSB-YI1D25"=gdetails(lgraphCCSBD25Clust))
table %>% knitr::kable(caption = "Details of the Largest Modules")
```

##Comparison of Modules
```{r, tidy=TRUE, tidy.opts=list(width.cutoff=60)}

intersect(names(V(lgraphUnionClust)),names(V(lgraphCCSBClust)))
intersect(names(V(lgraphUnionClust)),names(V(lgraphUnionD10Clust)))
intersect(names(V(lgraphUnionClust)),names(V(lgraphUnionD25Clust)))
intersect(names(V(lgraphCCSBClust)),names(V(lgraphCCSBD10Clust)))
intersect(names(V(lgraphCCSBClust)),names(V(lgraphCCSBD25Clust)))

details<-c("Union-M1v/sCCSB-M1","Union-M1v/sUnionD10-M1", "Union-M1v/sUnionD25-M1", "CCSB-M1v/sCCSBD10-M1", "CCSB-M1v/sCCSBD25-M1")
table<-data.frame(Comparisons=details,"Number of Gene Overlap"=c(length(intersect(names(V(lgraphUnionClust)), names(V(lgraphCCSBClust)))), length(intersect(names(V(lgraphUnionClust)), names(V(lgraphUnionD10Clust)))), length(intersect(names(V(lgraphUnionClust)), names(V(lgraphUnionD25Clust)))), length(intersect(names(V(lgraphCCSBClust)), names(V(lgraphCCSBD10Clust)))), length(intersect(names(V(lgraphCCSBClust)), names(V(lgraphCCSBD25Clust))))),"Number of Gene in Network 1"= c(vcount(lgraphUnionClust),vcount(lgraphUnionClust),vcount(lgraphUnionClust),vcount(lgraphCCSBClust),vcount(lgraphCCSBClust)), "Number of Gene in Network 2" = c(vcount(lgraphCCSBClust), vcount(lgraphUnionD10Clust), vcount(lgraphUnionD25Clust), vcount(lgraphCCSBD10Clust), vcount(lgraphCCSBD25Clust)))
table %>% knitr::kable(caption = "Details of the Largest Modules")
```



##iii).
For this question we selected the largest modules of both the PPI networks based on the number of nodes in the network. After that, we used the [Yeast Genome](http://yeastmine.yeastgenome.org/) website to carry out the GO terms enrichment analysis to get the common functions associated with the genes in the cluster.

From the figure it can s

![Y1-Union PPI Module 1 - Cytoscape]()
![CCSB PPI Module 1 - Cytoscape]()
![Y1-Union PPI Module 1 - Yeast genome Results]()
![Y1-Union PPI Module 1 - Revigo Treemap]()
![CCSB PPI Module 1 - Yeast genome Results]()
![CCSB PPI Module 1 - Revigo Treemap]()

